{"version":3,"sources":["webpack:///../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack:///../node_modules/@babel/runtime/helpers/esm/createClass.js","webpack:///../node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack:///external \"TYPO3/CMS/Backend/Modal\"","webpack:///external \"jquery\"","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./Backend/Modal/CacheWarmupProgressModal.ts"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","_defineProperty","obj","value","module","exports","__WEBPACK_EXTERNAL_MODULE__140__","__WEBPACK_EXTERNAL_MODULE__273__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","o","get","prop","hasOwnProperty","call","r","Symbol","toStringTag","$content","this","buildInitialModalContent","Modal","$modal","show","find","empty","append","createModalWithContent","hide","progress","percent","getProgressInPercent","failedCount","getNumberOfFailedUrls","current","total","$progressBar","attr","css","html","toFixed","addClass","$failedCounter","$allCounter","removeClass","$","title","TYPO3","lang","content","size","buttons","text","icon","btnClass","name","trigger"],"mappings":"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","file":"Backend/Modal/CacheWarmupProgressModal.js","sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","module.exports = __WEBPACK_EXTERNAL_MODULE__140__;","module.exports = __WEBPACK_EXTERNAL_MODULE__273__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Module: TYPO3/CMS/Warming/Backend/Modal/CacheWarmupProgressModal\n */\nimport WarmupProgress from '../../../lib/WarmupProgress';\n\n// Modules\nimport $ from 'jquery';\nimport Modal from 'TYPO3/CMS/Backend/Modal';\n\nclass CacheWarmupProgressModal {\n  private $modal!: JQuery;\n  private $progressBar!: JQuery;\n  private $allCounter!: JQuery;\n  private $failedCounter!: JQuery;\n\n  public createModal(): void {\n    const $content = this.buildInitialModalContent();\n\n    // Build initial modal or apply content to existing modal\n    if (Modal.currentModal) {\n      this.$modal = Modal.currentModal;\n      this.$modal.show();\n      this.$modal.find('.modal-body').empty().append($content);\n    } else {\n      this.$modal = this.createModalWithContent($content);\n    }\n\n    // Hide footer until cache warmup is finished\n    this.$modal.find('.modal-footer').hide();\n  }\n\n  public updateProgress(progress: WarmupProgress): void {\n    const percent = progress.getProgressInPercent();\n    const failedCount = progress.getNumberOfFailedUrls();\n    const {current, total} = progress.progress;\n\n    this.$progressBar.attr('aria-valuenow', current);\n    this.$progressBar.attr('aria-valuemax', total);\n    this.$progressBar.css('width', `${percent}%`);\n    this.$progressBar.html(`${percent.toFixed(2)}%`);\n\n    if (failedCount > 0) {\n      this.$progressBar.addClass('progress-bar-warning');\n      this.$failedCounter.show().html(`Failed: ${failedCount}`);\n    }\n\n    this.$allCounter.html(`Processed: <strong>${current}</strong><br>Total: <strong>${total}</strong>`);\n\n    if (current >= total) {\n      this.$progressBar.removeClass('progress-bar-warning').addClass(\n        failedCount > 0 ? 'progress-bar-danger' : 'progress-bar-success'\n      );\n    }\n  }\n\n  public getModal(): JQuery {\n    return this.$modal;\n  }\n\n  public getReportButton(): JQuery {\n    return this.$modal.find('button[name=tx-warming-open-report]');\n  }\n\n  public getRetryButton(): JQuery {\n    return this.$modal.find('button[name=tx-warming-retry]');\n  }\n\n  public dismiss(): void {\n    Modal.dismiss();\n  }\n\n  private buildInitialModalContent(): JQuery {\n    const $content = $('<div>');\n\n    this.$progressBar = $('<div class=\"progress-bar progress-bar-striped\">')\n      .attr('role', 'progressbar')\n      .attr('aria-valuemin', 0)\n      .attr('aria-valuemax', 0)\n      .attr('aria-valuenow', 0);\n    this.$allCounter = $('<div>').html('Crawling sitemaps...');\n    this.$failedCounter = $('<div class=\"badge badge-danger\">');\n\n    // Hide failed counter until any URL fails to be warmed up\n    this.$failedCounter.hide();\n\n    // Append progress bar and counter\n    $content\n      .append($('<div class=\"tx-warming-progress progress\">').append(this.$progressBar))\n      .append($('<div class=\"tx-warming-counter\">').append(this.$allCounter, this.$failedCounter));\n\n    return $content;\n  }\n\n  private createModalWithContent($content: JQuery): JQuery {\n    return Modal.advanced({\n      // @todo use other localization\n      title: TYPO3.lang['cacheWarmup.modal.title'],\n      content: $content,\n      size: Modal.sizes.small,\n      buttons: [\n        {\n          text: 'Show report',\n          icon: 'actions-list-alternative',\n          btnClass: 'btn-primary',\n          name: 'tx-warming-open-report',\n        },\n        {\n          text: 'Run again',\n          icon: 'actions-refresh',\n          btnClass: 'btn-default',\n          name: 'tx-warming-retry',\n        },\n        {\n          text: 'Close',\n          btnClass: 'btn-default',\n          trigger: () => {\n            Modal.dismiss();\n          },\n        },\n      ]\n    });\n  }\n}\n\nexport default new CacheWarmupProgressModal();\n"],"sourceRoot":""}